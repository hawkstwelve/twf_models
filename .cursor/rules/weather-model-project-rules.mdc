---
alwaysApply: true
---

# Weather Model Project Rules

## Tech Stack Context
- Backend: Python 3.10+ (FastAPI, Herbie, xarray, Cartopy, Matplotlib)
- Hosting: DigitalOcean Droplet (Ubuntu)
- Storage: DigitalOcean Spaces (S3-Compatible)
- Domain/Front-end: NixiHost (Shared) & theweatherforums.com integration

## Meteorological Coding Standards
- Data Handling: Always prioritize `xarray` and `dask` for GRIB2 processing to manage memory efficiently.
- Lon/Lat Conventions: Ensure all longitude conversions (0-360 vs -180 to 180) are handled explicitly when fetching from NOMADS vs displaying on maps.
- Projections: Use `ccrs.PlateCarree()` for data transformations and `ccrs.LambertConformal()` for PNW/US map displays.

## Performance & Cost Optimization
- Incremental Loading: Always write processing loops that update `manifest.json` after each forecast hour is rendered.
- Memory Management: Explicitly close Matplotlib figures with `plt.close()` and clear large xarray objects from memory after rendering.
- Egress: Prioritize generating compressed PNGs (optimize with `Pillow`) to minimize DigitalOcean bandwidth costs.

## AI Interaction Style
- Be concise. Use technical IT terminology.
- When suggesting system-level changes (e.g., Ubuntu dependencies for Cartopy), provide the exact `apt-get` commands.
